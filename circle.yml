machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker build -t usher-local .

test:
  override:
    - docker run --rm usher-local npm run test:circle

# deployment:
#   hub:
#     branch: master
#     commands:
#       - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
#       - docker tag usher-local:latest bapti/usher:$VERSION_NUM.$CIRCLE_BUILD_NUM
#       - docker tag usher-local:latest bapti/usher:latest
#       - docker push bapti/usher:$VERSION_NUM.$CIRCLE_BUILD_NUM
#       - docker push bapti/usher:latest

deployment:
  npm:
    branch: master
    commands:
      # login using environment variables
      - echo -e $NPM_USERNAME
      - echo -e $NPM_EMAIL
      - docker run --rm usher-local --env=\"NPM_USERNAME=$NPM_USERNAME\" --env=\"NPM_EMAIL=$NPM_EMAIL\" --env=\"NPM_PASSWORD=$NPM_PASSWORD\" npm run publish-to-npm
